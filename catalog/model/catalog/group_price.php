<?php
 class ModelCatalogGroupPrice extends Model{public function updatePrice($af2936bf7a63957e876440c3a6209977d,$a6c135bcb920c44054974268696a13e9d){$a8f7b6132cf9f70e2f6690dab76162e36=$this->getMinPrice($af2936bf7a63957e876440c3a6209977d);if($a8f7b6132cf9f70e2f6690dab76162e36['type']==2){$a6c135bcb920c44054974268696a13e9d=$a6c135bcb920c44054974268696a13e9d+$a8f7b6132cf9f70e2f6690dab76162e36['price'];}else{$a6c135bcb920c44054974268696a13e9d=$a6c135bcb920c44054974268696a13e9d+$a6c135bcb920c44054974268696a13e9d*$a8f7b6132cf9f70e2f6690dab76162e36['price']/100;}if($a6c135bcb920c44054974268696a13e9d<0){$a6c135bcb920c44054974268696a13e9d=0;}return $a6c135bcb920c44054974268696a13e9d;}private function getMinPrice($af2936bf7a63957e876440c3a6209977d){$a6c135bcb920c44054974268696a13e9d=array('price'=>0,'type'=>1);if($this->customer->isLogged()){$a1c7b95a92175eefde60f722f6b0b664a=$this->customer->getGroupId();}else{$a1c7b95a92175eefde60f722f6b0b664a=$this->config->get('config_customer_group_id');}$a4434a9251934f278be860d08e9241c7a=array();$this->load->model('catalog/product');$aa9234672972883d2ded973f1013e534f=$this->model_catalog_product->getCategories($af2936bf7a63957e876440c3a6209977d);foreach($aa9234672972883d2ded973f1013e534f as $a011d62e02427918bcbb82a83de06e3d7){$a4434a9251934f278be860d08e9241c7a[]=$a011d62e02427918bcbb82a83de06e3d7['category_id'];}if($a4434a9251934f278be860d08e9241c7a){$a8c028bf36adfb47495b27da2ccc26739="SELECT MIN(price) as price, type FROM ".DB_PREFIX."customer_group_price 
				WHERE category_id IN (".implode(',',$a4434a9251934f278be860d08e9241c7a).")"." AND customer_group_id = ".(int) $a1c7b95a92175eefde60f722f6b0b664a." GROUP BY customer_group_id ";$a8c028bf36adfb47495b27da2ccc26739=$this->db->query($a8c028bf36adfb47495b27da2ccc26739);}if($a4434a9251934f278be860d08e9241c7a&&isset($a8c028bf36adfb47495b27da2ccc26739->row['price'])){$a6c135bcb920c44054974268696a13e9d['category']['price']=$a8c028bf36adfb47495b27da2ccc26739->row['price'];$a6c135bcb920c44054974268696a13e9d['category']['type']=$a8c028bf36adfb47495b27da2ccc26739->row['type'];}else{$a8c028bf36adfb47495b27da2ccc26739="SELECT MIN(price) as price, type FROM ".DB_PREFIX."customer_group_price 
        WHERE category_id = 0 "." AND customer_group_id = ".(int) $a1c7b95a92175eefde60f722f6b0b664a." GROUP BY customer_group_id ";$a8c028bf36adfb47495b27da2ccc26739=$this->db->query($a8c028bf36adfb47495b27da2ccc26739);if(isset($a8c028bf36adfb47495b27da2ccc26739->row['price'])){$a6c135bcb920c44054974268696a13e9d['category']['price']=$a8c028bf36adfb47495b27da2ccc26739->row['price'];$a6c135bcb920c44054974268696a13e9d['category']['type']=$a8c028bf36adfb47495b27da2ccc26739->row['type'];}}if($a8f30808a7612410ec12814bd403768bd=$this->getProductManufacturer($af2936bf7a63957e876440c3a6209977d)){$a8c028bf36adfb47495b27da2ccc26739="SELECT price, type FROM ".DB_PREFIX."manufacturer_group_price WHERE manufacturer_id = ".(int) $a8f30808a7612410ec12814bd403768bd." AND customer_group_id = ".(int) $a1c7b95a92175eefde60f722f6b0b664a;$a8c028bf36adfb47495b27da2ccc26739=$this->db->query($a8c028bf36adfb47495b27da2ccc26739);if(isset($a8c028bf36adfb47495b27da2ccc26739->row['price'])){$a6c135bcb920c44054974268696a13e9d['manufacturer']['price']=$a8c028bf36adfb47495b27da2ccc26739->row['price'];$a6c135bcb920c44054974268696a13e9d['manufacturer']['type']=$a8c028bf36adfb47495b27da2ccc26739->row['type'];}}if(isset($a6c135bcb920c44054974268696a13e9d['manufacturer'])&&isset($a6c135bcb920c44054974268696a13e9d['category'])&&$a6c135bcb920c44054974268696a13e9d['manufacturer']['type']==$a6c135bcb920c44054974268696a13e9d['category']['type']){return($a6c135bcb920c44054974268696a13e9d['manufacturer']['price']>$a6c135bcb920c44054974268696a13e9d['category']['price'])?$a6c135bcb920c44054974268696a13e9d['manufacturer']:$a6c135bcb920c44054974268696a13e9d['category'];}elseif(isset($a6c135bcb920c44054974268696a13e9d['manufacturer'])){return $a6c135bcb920c44054974268696a13e9d['manufacturer'];}elseif(isset($a6c135bcb920c44054974268696a13e9d['category'])){return $a6c135bcb920c44054974268696a13e9d['category'];}return $a6c135bcb920c44054974268696a13e9d;}private function getProductManufacturer($af2936bf7a63957e876440c3a6209977d){$a8c028bf36adfb47495b27da2ccc26739="SELECT manufacturer_id FROM ".DB_PREFIX."product WHERE product_id = ".(int) $af2936bf7a63957e876440c3a6209977d;$a8c028bf36adfb47495b27da2ccc26739=$this->db->query($a8c028bf36adfb47495b27da2ccc26739);if(isset($a8c028bf36adfb47495b27da2ccc26739->row['manufacturer_id'])){return $a8c028bf36adfb47495b27da2ccc26739->row['manufacturer_id'];}return false;}}
//author sv2109 (sv2109@gmail.com) license for 1 product copy granted for Lixor (nikita@mt21.ru mt21.ru)
